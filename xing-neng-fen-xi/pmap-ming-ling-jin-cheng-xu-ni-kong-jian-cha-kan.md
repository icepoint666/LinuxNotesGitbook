# pmap命令——进程虚拟空间查看

### **pmap** - report memory map of a process\(**查看进程的内存映像信息**\)

{% embed url="https://man7.org/linux/man-pages/man1/pmap.1.html" %}

**pmap -d &lt;PID&gt;**

* -p, --show-path 
  * Show full path to files in the mapping column
* -x, --extended
  * Show the extended format.
* -X  Show even more details than the -x option
* -XX    Show everything the kernel provides
* -A, --range low,high
  * Limit results to the given range to low and high address range.  Notice that the low and high arguments are single string separated with comma.

```bash
$ pmap -d 45564 # 查看45564进程的虚拟内存信息， -d可以包含设备信息
695:   python train_DAN.py --arch DAN4 --fix DAN4 --batch_size 4 --group 3
Address           Kbytes Mode  Offset           Device    Mapping
0000000200000000    2048 ----- 0000000000000000 000:00000   [ anon ]
0000000200200000    2048 rw-s- 0000000000000000 000:00006 nvidiactl
0000000200400000    2048 rw-s- 0000000000000000 000:00006 nvidia1
0000000200600000   57344 rw-s- 0000000000000000 000:00006 nvidiactl
0000000203e00000    2048 rw-s- 0000000000000000 000:00006 nvidia1
0000000204000000   16384 ----- 0000000000000000 000:00000   [ anon ]
0000000205000000    2048 rw-s- 0000000000000000 000:00006 nvidiactl
0000000205200000    2048 rw-s- 0000000000000000 000:00006 nvidiactl
0000000205400000    2048 rw-s- 0000000205400000 000:00006 nvidia-uvm
0000000205600000    2048 rw-s- 0000000000000000 000:00006 nvidiactl
0000000205800000    2048 ----- 0000000000000000 000:00000   [ anon ]
0000000205a00000    2048 rw-s- 0000000000000000 000:00006 nvidiactl
0000000205c00000 4102144 ----- 0000000000000000 000:00000   [ anon ]
0000010000000000   65536 ----- 0000000000000000 000:00000   [ anon ]
000055f4363eb000     348 r---- 0000000000000000 008:00020 python3.6
000055f436442000    1824 r-x-- 0000000000057000 008:00020 python3.6
000055f43660a000     628 r---- 000000000021f000 008:00020 python3.6
000055f4366a8000      12 r---- 00000000002bc000 008:00020 python3.6
000055f4366ab000     396 rw--- 00000000002bf000 008:00020 python3.6
000055f43670e000     196 rw--- 0000000000000000 000:00000   [ anon ]
000055f43798a000 3480996 rw--- 0000000000000000 000:00000   [ anon ]
00007f1ee0000000 2195456 ----- 0000000000000000 000:00000   [ anon ]
00007f1f68000000     424 rw--- 0000000000000000 000:00000   [ anon ]
00007f1f6806a000   65112 ----- 0000000000000000 000:00000   [ anon ]
00007f1f6e000000 5275648 ----- 0000000000000000 000:00000   [ anon ]
00007f20b0851000   18464 r-x-- 0000000000000000 008:00020 libnvrtc.so.10.2.89
00007f20b1a59000    2044 ----- 0000000001208000 008:00020 libnvrtc.so.10.2.89
00007f20b1c58000    2592 r---- 0000000001207000 008:00020 libnvrtc.so.10.2.89
00007f20b1ee0000     472 rw--- 000000000148f000 008:00020 libnvrtc.so.10.2.89
00007f20b1f56000     672 rw--- 0000000000000000 000:00000   [ anon ]
...
00007f2297b78000       4 r---- 000000000000b000 008:00020 _struct.cpython-36m-x86_64-linux-gnu.so
00007f2297b79000       8 rw--- 000000000000c000 008:00020 _struct.cpython-36m-x86_64-linux-gnu.so
00007f2297b7b000      28 r--s- 0000000000000000 008:00011 gconv-modules.cache
00007f2297b82000       8 rw--- 0000000000000000 000:00000   [ anon ]
00007f2297b84000       4 r---- 0000000000027000 008:00011 ld-2.27.so
00007f2297b85000       4 rw--- 0000000000028000 008:00011 ld-2.27.so
00007f2297b86000       4 rw--- 0000000000000000 000:00000   [ anon ]
00007ffd4dcdd000     164 rw--- 0000000000000000 000:00000   [ stack ]
00007ffd4dd3a000      12 r---- 0000000000000000 000:00000   [ anon ]
00007ffd4dd3d000       4 r-x-- 0000000000000000 000:00000   [ anon ]
ffffffffff600000       4 --x-- 0000000000000000 000:00000   [ anon ]

```

* **64位系统**：**16位**16进制组成的地址
* 虽然是64位系统其实只有**48位来表示虚拟空间**，不需要那么大，前4位是会一直为0的
* **Address**:最开始的地址0000000200000000，**Kbytes**=2048，刚好到下一行的地址0000000200200000
* **Offset:**表示映射到对应文件中的偏移，如果是0表示从文件头开始映射
* 之后从开始地址往上堆到地址0000000205a00000，都在表示程序加载的一些底层驱动，nvidia相关只读段
* 000055f4363eb000开始表示python3.6程序的**代码段**
* 00007f20b0851000开始有大量的.so链接库表示**加载的动态库**
* 00007ffd4dcdd000表示**\[ stack \]进程栈空间**，只有164kb
* ffffffffff600000表示结束标记

**但是为什么没有看到\[ heap \]进程堆空间？**

**只有在-X命令下可以看到**

```bash
$ pmap -X 32931 #略去了一些列
32931:   /home/alkeybew/anaconda3/envs/Torch/bin/python /home/alkeybew/anaconda3/envs/Torch/bin/visdom -port 8002 --hostname localhost
         Address Perm   Offset Device     Inode    Size   Rss  Pss  Mapping
    55fa72c05000 r--p 00000000  08:20 122421412     380     0    0  python3.8
    55fa72c64000 r-xp 0005f000  08:20 122421412    1988   556  556  python3.8
    55fa72e55000 r--p 00250000  08:20 122421412     920    52   52  python3.8
    55fa72f3c000 r--p 00336000  08:20 122421412      20     8    8  python3.8
    55fa72f41000 rw-p 0033b000  08:20 122421412     224   116  116  python3.8
    55fa72f79000 rw-p 00000000  00:00         0     128   124  124 
    55fa73ce9000 rw-p 00000000  00:00         0   43916  3044 3044  [heap]
    7f383f769000 rw-p 00000000  00:00         0    2048    52   52  
    7f383f9a8000 rw-p 00000000  00:00         0    2560   312  312   
    7f383fc28000 r--p 00000000  08:20 122421364       8     0    0  _csv.cpython-38-x86_64-linux-gnu.so
```

* heap区域：在代码段的上方

注意：同一个机器**上不同进程的虚拟地址**是**可以相同的**，例如python的都是从0000000000200000开始。因为**进程虚拟空间是私有的**，但是**映射的物理地址**如果不是shared地址的话，就**必然不可能相同**的

